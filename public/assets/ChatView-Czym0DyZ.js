import{g as Ne,m as Ue,c as ue,i as Ae,s as Te,u as we,e as qe,f as Fe,n as je,b as Me}from"./vendor-primevue-CFcGQxZZ.js";import{r as S,D as ae,w as ge,d as be,f as y,v as P,j as e,t as r,V as _,q as xe,B as ee,x as v,A as Z,H as ke,J as Ee,h as x,F as ie,z as ne,e as K,G as Ce,o as Oe,n as se,a2 as Le,I as Be,a0 as Je,U as ze,N as He}from"./vendor-vue-6-0MiUoZ.js";import{I as Re,_ as me,u as pe}from"./index-ggOyftwP.js";class Ke{constructor(){this.baseUrl="/.netlify/functions",this.cache=new Map,this.CACHE_DURATION=120*1e3}async listTemplates(){const s=await fetch("/.netlify/functions/automation-engine",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"list_templates"})});if(!s.ok)throw new Error("Failed to list templates");return s.json()}async smartSuggest(s){const t=await fetch("/.netlify/functions/automation-engine",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"smart_suggest",payload:{userInput:s}})});if(!t.ok)throw new Error("Failed to get suggestion");return t.json()}async multiSourceSchema(s,t){const a=await fetch("/.netlify/functions/multi-source-schema-generator",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:s,availableTemplates:t})});if(!a.ok)throw new Error("Failed to get schema");return a.json()}async geminiChat(s,t=Re.defaultLocale){const a=await fetch("/.netlify/functions/gemini-chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:s,history:[],language:t})});if(!a.ok)throw new Error("Failed to get AI response");return a.json()}async createMultiSourceDatabase(s,t="separate"){const a=await fetch("/.netlify/functions/create-multi-source-database",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({schema:s,mode:t})}),m=await a.text();if(console.log("Raw response:",m.substring(0,200)),!a.ok){console.error("Failed to create system:",a.status,a.statusText);try{const i=JSON.parse(m),g=i.error||i.message||`HTTP ${a.status}: ${a.statusText}`;throw new Error(g)}catch{throw new Error(`HTTP ${a.status}: ${a.statusText}`)}}try{return JSON.parse(m)}catch(i){throw console.error("Failed to parse response:",i),new Error("Invalid response from server")}}async deployTemplate(s,t={},a=!0){const m=await fetch("/.netlify/functions/automation-engine",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"deploy_template",payload:{templateId:s,customizations:t,includeSampleData:a}})});if(!m.ok)throw new Error("Failed to deploy template");return m.json()}async triggerAutomation(s){try{const t=await fetch(`${this.baseUrl}/automation-engine`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!t.ok){const m=await t.json().catch(()=>({}));throw new Error(m.error||`HTTP ${t.status}`)}return await t.json()}catch(t){throw console.error("Error triggering automation:",t),new Error(`Failed to trigger automation: ${t.message}`)}}async getAutomationStatus(s){const t=`automation_status_${s}`;if(this.cache.has(t)){const a=this.cache.get(t);if(Date.now()-a.timestamp<this.CACHE_DURATION)return a.data}try{const a=await fetch(`${this.baseUrl}/automation-monitor?id=${s}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!a.ok){const i=await a.json().catch(()=>({}));throw new Error(i.error||`HTTP ${a.status}`)}const m=await a.json();return this.cache.set(t,{data:m,timestamp:Date.now()}),m}catch(a){throw console.error("Error getting automation status:",a),new Error(`Failed to get automation status: ${a.message}`)}}async getAllAutomationStatuses(){const s="all_automation_statuses";if(this.cache.has(s)){const t=this.cache.get(s);if(Date.now()-t.timestamp<this.CACHE_DURATION)return t.data}try{const t=await fetch(`${this.baseUrl}/automation-monitor`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok){const m=await t.json().catch(()=>({}));throw new Error(m.error||`HTTP ${t.status}`)}const a=await t.json();return this.cache.set(s,{data:a,timestamp:Date.now()}),a}catch(t){throw console.error("Error getting all automation statuses:",t),new Error(`Failed to get automation statuses: ${t.message}`)}}clearCache(){this.cache.clear()}clearCacheByPattern(s){for(const t of this.cache.keys())t.includes(s)&&this.cache.delete(t)}}const fe=new Ke,Ge={class:"w-full"},Qe={class:"flex items-center gap-4"},We={class:"text-center md:text-left"},Ze={class:"text-2xl md:text-3xl font-bold text-white drop-shadow-sm"},Xe={class:"box-border bg-gradient-to-br from-slate-50 to-slate-100"},Ye={class:"h-full scrollbar-auto-hide p-8"},et={class:"mb-8"},tt={class:"text-gray-600 text-center md:text-left"},st={class:"text-sm text-gray-500 mt-1"},at={class:"bg-white rounded-2xl shadow-lg border border-gray-100 mb-8 overflow-hidden"},ot={class:"flex items-center justify-between"},lt={class:"flex items-center gap-2"},rt={class:"text-lg font-semibold text-gray-900"},it={class:"flex items-center gap-2"},nt={class:"text-sm text-gray-500"},dt={class:"p-6 transition-all duration-300"},ct={class:"mb-6"},ut={class:"flex items-center font-semibold text-gray-700 mb-2 text-sm"},mt={class:"mb-6"},pt={class:"flex items-center font-semibold text-gray-700 mb-2 text-sm"},ht={class:"mb-8"},gt={class:"flex items-center gap-2"},ft={class:"text-lg font-semibold text-gray-900"},bt={class:"bg-gradient-to-r from-emerald-500 to-emerald-600 text-white px-3 py-1 rounded-full text-xs font-semibold ml-2"},yt={class:"flex items-center gap-2"},_t={class:"bg-gradient-to-r from-blue-500 via-purple-500 via-pink-500 to-orange-500 rounded-lg px-4 py-2 shadow-lg flex items-center gap-2"},vt={class:"text-white font-semibold"},xt={class:"text-sm text-gray-500"},wt={class:"grid gap-6 grid-cols-1 lg:grid-cols-2 xl:grid-cols-2 transition-all duration-300"},$t={class:"bg-gradient-to-r from-slate-50 to-slate-100 px-6 py-4 flex justify-between items-center border-b border-gray-100"},kt={class:"flex items-center gap-3"},St={class:"text-base font-bold text-gray-900 m-0"},Tt={class:"text-sm text-gray-600 mt-1 m-0"},jt={class:"p-6"},Mt={class:"mb-6"},Et={class:"flex items-center font-semibold text-gray-700 mb-2 text-sm"},Ct={class:"mb-6"},Ot={class:"flex items-center font-semibold text-gray-700 mb-2 text-sm"},Dt={class:"mt-6 pt-6 border-t border-gray-100"},Vt={class:"flex justify-between items-center mb-4"},It={class:"flex items-center gap-2"},Pt={class:"font-semibold text-gray-700 text-sm"},Nt={class:"bg-gradient-to-r from-purple-500 to-purple-600 text-white px-2 py-1 rounded-xl text-xs font-semibold ml-2"},Ut={class:"bg-gradient-to-r from-blue-500 via-purple-500 via-pink-500 to-orange-500 rounded-md px-3 py-1.5 shadow-lg flex items-center gap-1"},At={class:"text-white font-semibold text-xs"},qt={class:"flex flex-col gap-4"},Ft={class:"flex justify-between items-center mb-3"},Lt={class:"flex gap-3 flex-1"},Bt={key:0,class:"mt-3 pt-3 border-t border-gray-200"},Jt={class:"flex items-center text-xs font-semibold text-gray-600 mb-2"},zt={key:1,class:"mt-3 pt-3 border-t border-gray-200"},Ht={class:"flex items-center text-xs font-semibold text-gray-600 mb-2"},Rt={class:"flex justify-end gap-4 mt-8 pt-8 border-t border-gray-100"},Kt={class:"bg-gradient-to-r from-blue-500 via-purple-500 via-pink-500 to-orange-500 rounded-lg p-0.5 shadow-lg"},Gt={class:"bg-white rounded-md px-6 py-3 flex items-center gap-2"},Qt={class:"bg-gradient-to-r from-blue-500 via-purple-500 via-pink-500 to-orange-500 bg-clip-text text-transparent font-semibold"},Wt={class:"bg-gradient-to-r from-blue-500 via-purple-500 via-pink-500 to-orange-500 rounded-lg px-6 py-3 shadow-lg flex items-center gap-2"},Zt={class:"text-white font-semibold"},Xt={__name:"MultiSourceEditModal",props:{visible:{type:Boolean,default:!1},schema:{type:Object,default:()=>({title:"",description:"",dataSources:[]})},fromTemplate:{type:Boolean,default:!1}},emits:["update:visible","create","cancel"],setup(E,{emit:s}){const{t}=pe(),a=E,m=s,i=S(!1),g=ae(()=>typeof window>"u"?!1:window.innerWidth<=768),p={root:{class:"rounded-l-2xl shadow-2xl border border-white/10 backdrop-blur-sm bg-transparent"},header:{class:"bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 text-white rounded-l-2xl !py-2 !px-4"},content:{class:"bg-gradient-to-br from-slate-50 to-slate-100 rounded-b-2xl"}},u=S(!0),$=S(!0),l=S({title:"",description:"",dataSources:[]});ge(()=>a.schema,V=>{V&&(V.title||V.description||V.dataSources)&&(l.value=JSON.parse(JSON.stringify(V)),l.value.dataSources?.length>0)},{immediate:!0,deep:!0}),ge(()=>a.visible,V=>{typeof document<"u"&&(V?document.body.style.overflow="hidden":(document.body.style.overflow="",i.value=!1))});const f=[{label:t("database.property_types.title"),value:"title"},{label:t("database.property_types.rich_text"),value:"rich_text"},{label:t("database.property_types.number"),value:"number"},{label:t("database.property_types.select"),value:"select"},{label:t("database.property_types.multi_select"),value:"multi_select"},{label:t("database.property_types.date"),value:"date"},{label:t("database.property_types.people"),value:"people"},{label:t("database.property_types.files"),value:"files"},{label:t("database.property_types.checkbox"),value:"checkbox"},{label:t("database.property_types.url"),value:"url"},{label:t("database.property_types.email"),value:"email"},{label:t("database.property_types.phone_number"),value:"phone_number"},{label:t("database.property_types.created_time"),value:"created_time"},{label:t("database.property_types.created_by"),value:"created_by"},{label:t("database.property_types.last_edited_time"),value:"last_edited_time"},{label:t("database.property_types.last_edited_by"),value:"last_edited_by"}],T=[{label:t("database.number_formats.number"),value:"number"},{label:t("database.number_formats.percent"),value:"percent"},{label:t("database.number_formats.dollar"),value:"dollar"},{label:t("database.number_formats.euro"),value:"euro"},{label:t("database.number_formats.pound"),value:"pound"},{label:t("database.number_formats.yen"),value:"yen"},{label:t("database.number_formats.ruble"),value:"ruble"},{label:t("database.number_formats.rupee"),value:"rupee"},{label:t("database.number_formats.won"),value:"won"},{label:t("database.number_formats.yuan"),value:"yuan"}],w=()=>{l.value.dataSources.push({name:"",description:"",properties:[]})},z=V=>{l.value.dataSources.splice(V,1)},D=V=>{l.value.dataSources[V].properties.push({name:"",type:"rich_text",options:"",format:"number"})},B=(V,h)=>{l.value.dataSources[V].properties.splice(h,1)},Q=async()=>{i.value=!0;try{const V={title:l.value.title,description:l.value.description,dataSources:l.value.dataSources.map(h=>({name:h.name,description:h.description,properties:h.properties.reduce((X,F)=>{if(F.name&&F.type){let H={};if(F.type==="select"||F.type==="multi_select"){const oe=F.options.split(`
`).filter(te=>te.trim()).map(te=>({name:te.trim(),color:"blue"}));H[F.type]={options:oe}}else F.type==="number"?H[F.type]={format:F.format||"number"}:H[F.type]={};X[F.name]=H}return X},{})}))};m("create",{schema:V,fromTemplate:a.fromTemplate})}catch(V){console.error("Error in handleCreate:",V),i.value=!1}},G=()=>{m("cancel")};return(V,h)=>{const X=Ne,F=Ue,H=ue,oe=Ae,te=Te;return y(),be(te,{visible:E.visible,"onUpdate:visible":h[4]||(h[4]=U=>V.$emit("update:visible",U)),position:g.value?"bottom":"right",style:Ce(g.value?{height:"90vh"}:{width:"95vw",maxWidth:"1400px"}),pt:p},{header:P(()=>[e("div",Ge,[e("div",Qe,[h[5]||(h[5]=e("div",{class:"w-12 h-12 md:w-14 md:h-14 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center border border-white/10"},[e("i",{class:"pi pi-database text-white text-lg md:text-xl"})],-1)),e("div",We,[e("h2",Ze,r(_(t)("multisource_modal.header")),1)])])])]),default:P(()=>[e("div",Xe,[e("div",Ye,[e("div",et,[e("p",tt,r(_(t)("multisource_modal.review_customize_description")),1),e("p",st,"ðŸ’¡"+r(_(t)("chat.close_modal_reopen_tip")),1)]),e("div",at,[e("div",{class:"bg-gradient-to-r from-slate-50 to-slate-100 px-6 py-4 border-b border-gray-100 cursor-pointer transition-all duration-200 hover:from-slate-100 hover:to-slate-200 hover:-translate-y-0.5 hover:shadow-md",onClick:h[0]||(h[0]=U=>u.value=!u.value)},[e("div",ot,[e("div",lt,[h[6]||(h[6]=e("i",{class:"pi pi-cog text-blue-600"},null,-1)),e("h3",rt,r(_(t)("multisource_modal.system_information")),1)]),e("div",it,[e("span",nt,r(u.value?_(t)("multisource_modal.hide"):_(t)("multisource_modal.show")),1),e("i",{class:ee(["pi transition-transform duration-200",u.value?"pi-chevron-up":"pi-chevron-down"])},null,2)])])]),xe(e("div",dt,[e("div",ct,[e("label",ut,[h[7]||(h[7]=e("i",{class:"pi pi-tag mr-2"},null,-1)),Z(" "+r(_(t)("multisource_modal.system_title")),1)]),v(X,{modelValue:l.value.title,"onUpdate:modelValue":h[1]||(h[1]=U=>l.value.title=U),class:"w-full border-2 border-gray-200 rounded-lg px-3 py-2 text-sm transition-all duration-200 focus:border-indigo-500 focus:shadow-lg focus:outline-none bg-white",placeholder:_(t)("multisource_modal.enter_system_title")},null,8,["modelValue","placeholder"])]),e("div",mt,[e("label",pt,[h[8]||(h[8]=e("i",{class:"pi pi-file-edit mr-2"},null,-1)),Z(" "+r(_(t)("multisource_modal.system_description")),1)]),v(F,{modelValue:l.value.description,"onUpdate:modelValue":h[2]||(h[2]=U=>l.value.description=U),class:"w-full border-2 border-gray-200 rounded-lg px-3 py-2 text-sm transition-all duration-200 focus:border-indigo-500 focus:shadow-lg focus:outline-none bg-white resize-none",rows:"3",placeholder:_(t)("multisource_modal.enter_system_description")},null,8,["modelValue","placeholder"])])],512),[[ke,u.value]])]),e("div",ht,[e("div",{class:"flex justify-between items-center mb-6 rounded-2xl shadow-lg px-6 py-4 cursor-pointer transition-all duration-200 hover:-translate-y-0.5 hover:shadow-sm",onClick:h[3]||(h[3]=U=>$.value=!$.value)},[e("div",gt,[h[9]||(h[9]=e("i",{class:"pi pi-server text-green-600"},null,-1)),e("h3",ft,r(_(t)("multisource_modal.data_sources")),1),e("span",bt,r(l.value.dataSources.length),1)]),e("div",yt,[v(H,{icon:"pi pi-plus",label:_(t)("multisource_modal.add_data_source"),size:"small",severity:"secondary",text:"",class:"p-0",onClick:Ee(w,["stop"])},{default:P(()=>[e("div",_t,[h[10]||(h[10]=e("i",{class:"pi pi-plus text-white"},null,-1)),e("span",vt,r(_(t)("multisource_modal.add_data_source")),1)])]),_:1},8,["label"]),e("span",xt,r($.value?_(t)("multisource_modal.hide"):_(t)("multisource_modal.show")),1),e("i",{class:ee(["pi transition-transform duration-200",$.value?"pi-chevron-up":"pi-chevron-down"])},null,2)])]),xe(e("div",wt,[(y(!0),x(ie,null,ne(l.value.dataSources,(U,Y)=>(y(),x("div",{key:Y,class:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden transition-all duration-300 hover:-translate-y-1 hover:shadow-xl"},[e("div",$t,[e("div",kt,[h[11]||(h[11]=e("div",{class:"w-10 h-10 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center shadow-md"},[e("i",{class:"pi pi-table text-white text-sm"})],-1)),e("div",null,[e("h4",St,r(_(t)("multisource_modal.data_source"))+" "+r(Y+1),1),e("p",Tt,r(U.name||_(t)("multisource_modal.untitled")),1)])]),l.value.dataSources.length>1?(y(),be(H,{key:0,icon:"pi pi-trash",severity:"danger",text:"",size:"small",class:"opacity-70 transition-all duration-200 hover:opacity-100 hover:scale-110",onClick:A=>z(Y)},null,8,["onClick"])):K("",!0)]),e("div",jt,[e("div",Mt,[e("label",Et,[h[12]||(h[12]=e("i",{class:"pi pi-tag mr-2"},null,-1)),Z(" "+r(_(t)("multisource_modal.data_source_name")),1)]),v(X,{modelValue:U.name,"onUpdate:modelValue":A=>U.name=A,class:"w-full border-2 border-gray-200 rounded-lg px-3 py-2 text-sm transition-all duration-200 focus:border-indigo-500 focus:shadow-lg focus:outline-none bg-white",placeholder:_(t)("multisource_modal.enter_data_source_name")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),e("div",Ct,[e("label",Ot,[h[13]||(h[13]=e("i",{class:"pi pi-file-edit mr-2"},null,-1)),Z(" "+r(_(t)("multisource_modal.description")),1)]),v(F,{modelValue:U.description,"onUpdate:modelValue":A=>U.description=A,class:"w-full border-2 border-gray-200 rounded-lg px-3 py-2 text-sm transition-all duration-200 focus:border-indigo-500 focus:shadow-lg focus:outline-none bg-white resize-none",rows:"2",placeholder:_(t)("multisource_modal.enter_data_source_description")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),e("div",Dt,[e("div",Vt,[e("div",It,[h[14]||(h[14]=e("i",{class:"pi pi-th-large text-purple-600"},null,-1)),e("label",Pt,r(_(t)("multisource_modal.properties")),1),e("span",Nt,r(U.properties.length),1)]),v(H,{icon:"pi pi-plus",label:_(t)("multisource_modal.add_property"),size:"small",severity:"secondary",text:"",class:"p-0",onClick:A=>D(Y)},{default:P(()=>[e("div",Ut,[h[15]||(h[15]=e("i",{class:"pi pi-plus text-white text-xs"},null,-1)),e("span",At,r(_(t)("multisource_modal.add_property")),1)])]),_:2},1032,["label","onClick"])]),e("div",qt,[(y(!0),x(ie,null,ne(U.properties,(A,ce)=>(y(),x("div",{key:ce,class:"bg-gradient-to-r from-slate-50 to-slate-100 border border-gray-200 rounded-xl p-4 transition-all duration-200 hover:border-indigo-300 hover:shadow-md"},[e("div",Ft,[e("div",Lt,[v(X,{modelValue:A.name,"onUpdate:modelValue":o=>A.name=o,placeholder:_(t)("multisource_modal.property_name"),class:"flex-2 border border-gray-300 rounded-md px-2 py-1.5 text-sm transition-all duration-200 focus:border-indigo-500 focus:shadow-sm focus:outline-none"},null,8,["modelValue","onUpdate:modelValue","placeholder"]),v(oe,{modelValue:A.type,"onUpdate:modelValue":o=>A.type=o,options:f,optionLabel:"label",optionValue:"value",placeholder:_(t)("multisource_modal.type"),class:"flex-1 min-w-[120px]"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),v(H,{icon:"pi pi-trash",severity:"danger",text:"",size:"small",class:"opacity-60 transition-all duration-200 hover:opacity-100 hover:scale-110",onClick:o=>B(Y,ce)},null,8,["onClick"])]),A.type==="select"||A.type==="multi_select"?(y(),x("div",Bt,[e("label",Jt,[h[16]||(h[16]=e("i",{class:"pi pi-list mr-1"},null,-1)),Z(" "+r(_(t)("multisource_modal.options_one_per_line")),1)]),v(F,{modelValue:A.options,"onUpdate:modelValue":o=>A.options=o,rows:"2",class:"w-full border border-gray-300 rounded-md px-2 py-1.5 text-sm resize-y transition-all duration-200 focus:border-indigo-500 focus:shadow-sm focus:outline-none",placeholder:`Option 1
Option 2
Option 3`},null,8,["modelValue","onUpdate:modelValue"])])):K("",!0),A.type==="number"?(y(),x("div",zt,[e("label",Ht,[h[17]||(h[17]=e("i",{class:"pi pi-calculator mr-1"},null,-1)),Z(" "+r(_(t)("multisource_modal.format")),1)]),v(oe,{modelValue:A.format,"onUpdate:modelValue":o=>A.format=o,options:T,optionLabel:"label",optionValue:"value",placeholder:_(t)("multisource_modal.format"),class:"w-full max-w-[200px]"},null,8,["modelValue","onUpdate:modelValue","placeholder"])])):K("",!0)]))),128))])])])]))),128))],512),[[ke,$.value]])]),e("div",Rt,[v(H,{label:_(t)("multisource_modal.cancel"),severity:"secondary",text:"",class:"p-0",onClick:G},{default:P(()=>[e("div",Kt,[e("div",Gt,[e("span",Qt,r(_(t)("multisource_modal.cancel")),1)])])]),_:1},8,["label"]),v(H,{label:_(t)("multisource_modal.create_databases"),severity:"secondary",text:"",class:"p-0",onClick:Q,loading:i.value},{default:P(()=>[e("div",Wt,[e("span",Zt,r(_(t)("multisource_modal.create_databases")),1)])]),_:1},8,["label","loading"])])])])]),_:1},8,["visible","position","style"])}}},De=me(Xt,[["__scopeId","data-v-62c8a6d2"]]),Yt={class:"bg-gradient-to-br from-slate-50 to-slate-100"},es={class:"px-4 my-8"},ts={class:"text-black/80 mt-1 text-sm md:text-base"},ss={class:"flex flex-col md:flex-row items-center justify-between gap-4 md:gap-0"},as={class:"flex flex-wrap gap-2 md:gap-3 items-center justify-center md:justify-end w-full"},os={class:"bg-gradient-to-r from-blue-500 via-purple-500 via-pink-500 to-orange-500 rounded-lg p-0.5 shadow-lg"},ls={class:"bg-white rounded-md px-3 py-2 flex items-center gap-2"},rs={class:"bg-gradient-to-r from-blue-500 via-purple-500 via-pink-500 to-orange-500 bg-clip-text text-transparent font-medium"},is={class:"bg-gradient-to-r from-blue-500 via-purple-500 via-pink-500 to-orange-500 rounded-lg p-0.5 shadow-lg"},ns={class:"bg-white rounded-md px-3 py-2 flex items-center gap-2"},ds={class:"bg-gradient-to-r from-blue-500 via-purple-500 via-pink-500 to-orange-500 bg-clip-text text-transparent font-medium"},cs={class:"bg-gradient-to-r from-blue-500 via-purple-500 via-pink-500 to-orange-500 rounded-lg px-3 py-2 shadow-lg flex items-center gap-2"},us={class:"text-white font-medium"},ms={key:0,class:"flex items-center justify-center min-h-96 px-8"},ps={class:"text-center max-w-md"},hs={class:"text-2xl font-semibold text-slate-800 mb-2"},gs={class:"text-slate-600 mb-8 leading-relaxed"},fs={class:"bg-gradient-to-r from-blue-500 via-purple-500 via-pink-500 to-orange-500 rounded-lg px-4 py-3 shadow-lg flex items-center gap-2"},bs={class:"text-white font-medium"},ys={key:1,class:"grid grid-cols-1 sm:grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4 md:gap-6 px-2 md:px-4 pb-4"},_s={class:"flex justify-between items-start mb-3 md:mb-4"},vs={class:"flex-1 min-w-0"},xs={class:"text-lg md:text-xl font-semibold text-slate-800 mb-1 md:mb-2 truncate"},ws={class:"text-xs md:text-sm text-slate-600 mb-2 md:mb-3 leading-relaxed line-clamp-2"},$s={class:"flex items-center gap-2 md:gap-3 flex-wrap"},ks={class:"text-xs text-slate-500 font-medium"},Ss={key:0,class:"px-2 md:px-3 py-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white text-xs font-semibold rounded-full uppercase tracking-wide"},Ts={key:1,class:"px-2 md:px-3 py-1 bg-gradient-to-r from-slate-200 to-slate-300 text-slate-600 text-xs font-semibold rounded-full uppercase tracking-wide"},js={class:"flex gap-2"},Ms={class:"bg-gradient-to-r from-blue-500 via-purple-500 via-pink-500 to-orange-500 rounded-lg p-0.5 shadow-lg w-full"},Es={class:"bg-white rounded-md px-2 py-1 flex items-center justify-center gap-1"},Cs={class:"bg-gradient-to-r from-blue-500 via-purple-500 via-pink-500 to-orange-500 bg-clip-text text-transparent font-medium text-xs"},Os={class:"bg-gradient-to-r from-blue-500 via-purple-500 via-pink-500 to-orange-500 rounded-lg p-0.5 shadow-lg w-full"},Ds={class:"bg-white rounded-md px-2 py-1 flex items-center justify-center gap-1"},Vs={class:"bg-gradient-to-r from-blue-500 via-purple-500 via-pink-500 to-orange-500 bg-clip-text text-transparent font-medium text-xs"},Is={class:"bg-gradient-to-r from-blue-500 via-purple-500 via-pink-500 to-orange-500 rounded-lg px-2 py-1 shadow-lg flex items-center justify-center gap-1 w-full"},Ps={class:"text-white font-medium text-xs"},Ns={class:"space-y-4"},Us={class:"block text-sm font-medium text-gray-700 mb-2"},As={class:"flex items-center gap-2"},qs={for:"overwrite",class:"text-sm text-gray-700"},Fs={key:0,class:"bg-gray-50 p-4 rounded-lg"},Ls={class:"font-medium text-gray-900 mb-2"},Bs={class:"text-sm text-gray-600"},Js={class:"list-disc list-inside mt-2"},zs={class:"flex justify-end gap-2"},Hs={__name:"TemplateEditor",emits:["template-deployed"],setup(E,{emit:s}){const t=s,a=we(),m=qe(),{t:i}=pe(),g=S([]),p=S(!1),u=S(!1),$=S(null),l=S(null),f=S(!1),T=S(!1);S(!1);const w=S(!1),z=S(""),D=S(null),B=S(!1),Q=S({title:"",description:"",dataSources:[]}),G=async()=>{try{const n=await(await fetch("/.netlify/functions/automation-engine",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"list_templates"})})).json();g.value=n.templates||[]}catch(o){console.error("Error loading templates:",o),a.add({severity:"error",summary:i("common.error"),detail:i("templates.failed_to_load_templates"),life:5e3})}},V=()=>{Q.value={title:"",description:"",dataSources:[{name:i("templates.main_database"),description:i("templates.primary_database_description"),properties:[{name:"Name",type:"title",options:"",format:"number"}]}]},$.value=null,l.value=null,w.value=!1,z.value="",p.value=!0},h=async o=>{try{const n=await fetch("/.netlify/functions/automation-engine",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"get_template_schema",payload:{templateId:o.id}})});if(n.ok){const b=await n.json(),k=b.schema?.dataSources&&b.schema.dataSources[0]?.properties||b.schema?.properties||o.properties;Q.value={title:b.schema?.title||o.title,description:b.schema?.description||o.description,dataSources:[{name:i("templates.main_database"),description:i("templates.primary_database_description"),properties:Object.entries(k||{}).map(([q,j])=>{let C="rich_text",I="",le="number";return j.title?C="title":j.rich_text?C="rich_text":j.number?(C="number",le=j.number.format||"number"):j.select?(C="select",I=j.select.options?j.select.options.map(he=>he.name).join(`
`):""):j.multi_select?(C="multi_select",I=j.multi_select.options?j.multi_select.options.map(he=>he.name).join(`
`):""):j.date?C="date":j.people?C="people":j.files?C="files":j.checkbox?C="checkbox":j.url?C="url":j.email?C="email":j.phone_number?C="phone_number":j.created_time?C="created_time":j.created_by?C="created_by":j.last_edited_time?C="last_edited_time":j.last_edited_by&&(C="last_edited_by"),{name:q,type:C,options:I,format:le}})}]},$.value={...o},l.value=o.id,p.value=!0}else throw new Error("Failed to load template schema")}catch(n){console.error("Error loading template:",n),a.add({severity:"error",summary:i("common.error"),detail:i("templates.failed_to_load_template_details"),life:5e3})}},X=async o=>{const n={id:$.value?.id||`template_${Date.now()}`,title:o.title,description:o.description,properties:{}};if(o.dataSources.length>0&&o.dataSources[0].properties.forEach(k=>{if(k.name&&k.type){let q={};if(k.type==="select"||k.type==="multi_select"){const j=k.options.split(`
`).filter(C=>C.trim()).map(C=>({name:C.trim(),color:"blue"}));q[k.type]={options:j}}else k.type==="number"?q[k.type]={format:k.format||"number"}:q[k.type]={};n.properties[k.name]=q}}),w.value&&z.value)try{n.sampleData=JSON.parse(z.value)}catch{a.add({severity:"warn",summary:i("templates.invalid_json"),detail:i("templates.sample_data_must_be_valid_json"),life:5e3});return}f.value=!0;try{const b=l.value?"update_template":"save_template",k=l.value?{templateId:l.value,updates:n}:{templateId:n.id,template:n},j=await(await fetch("/.netlify/functions/automation-engine",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:b,payload:k})})).json();if(j.success)a.add({severity:"success",summary:i("common.success"),detail:j.message,life:5e3}),p.value=!1,await G();else throw new Error(j.error||"Failed to save template")}catch(b){console.error("Error saving template:",b),a.add({severity:"error",summary:i("common.error"),detail:b.message,life:5e3})}finally{f.value=!1}},F=()=>{p.value=!1,$.value=null,l.value=null},H=async o=>{const n=`${o.id}_copy_${Date.now()}`;try{const k=await(await fetch("/.netlify/functions/automation-engine",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"duplicate_template",payload:{templateId:o.id,newTemplateId:n,customizations:{title:`${o.title} (Copy)`}}})})).json();if(k.success)a.add({severity:"success",summary:i("common.success"),detail:i("templates.template_duplicated_successfully"),life:5e3}),await G();else throw new Error(k.error||"Failed to duplicate template")}catch(b){console.error("Error duplicating template:",b),a.add({severity:"error",summary:i("common.error"),detail:b.message,life:5e3})}},oe=async o=>{try{const b=await(await fetch("/.netlify/functions/automation-engine",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"deploy_template",payload:{templateId:o.id,includeSampleData:!0}})})).json();if(b.database)a.add({severity:"success",summary:i("common.success"),detail:i("templates.database_created_successfully",{title:b.database.title}),life:5e3}),t("template-deployed",b.database);else throw new Error("Failed to create database")}catch(n){console.error("Error deploying template:",n),a.add({severity:"error",summary:i("common.error"),detail:i("templates.failed_to_deploy_template"),life:5e3})}},te=async o=>{m.require({message:i("templates.delete_template_confirmation",{title:o.title}),header:i("templates.delete_template"),icon:"pi pi-exclamation-triangle",rejectProps:{label:i("common.cancel"),severity:"secondary",outlined:!0},acceptProps:{label:i("common.delete"),severity:"danger"},accept:async()=>{try{const n=await fetch("/.netlify/functions/automation-engine",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"delete_template",payload:{templateId:o.id}})});if(!n.ok){const k=await n.text().catch(()=>"");throw new Error(k||`HTTP ${n.status}`)}const b=await n.json();if(b.success)a.add({severity:"success",summary:i("common.success"),detail:b.message,life:5e3}),await G();else throw new Error(b.error||"Failed to delete template")}catch(n){console.error("Error deleting template:",n),a.add({severity:"error",summary:i("common.error"),detail:n?.message||i("templates.failed_to_delete_template"),life:5e3})}}})},U=async()=>{try{const o=await fetch("/.netlify/functions/automation-engine",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"export_templates",payload:{includeSystem:!0}})});if(!o.ok){const I=await o.text().catch(()=>"");throw new Error(I||`HTTP ${o.status}`)}const n=o.headers.get("Content-Disposition")||o.headers.get("content-disposition"),b=n&&n.split("filename=")[1]||"notion-templates.json",k=await o.json();if(!k||typeof k!="object")throw new Error("Invalid export payload");const q=new Blob([JSON.stringify(k,null,2)],{type:"application/json"}),j=URL.createObjectURL(q),C=document.createElement("a");C.href=j,C.download=b.replace(/^"|"$/g,""),document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(j),a.add({severity:"success",summary:i("templates.export_ready"),detail:i("templates.templates_exported_successfully"),life:5e3})}catch(o){console.error("Error exporting templates:",o),a.add({severity:"error",summary:i("templates.export_failed"),detail:o?.message||i("templates.failed_to_export_templates"),life:5e3})}},Y=()=>{u.value=!0,D.value=null},A=o=>{const n=o.target.files[0];if(!n)return;const b=new FileReader;b.onload=k=>{try{const q=JSON.parse(k.target.result);if(!q||typeof q!="object"||!q.templates||typeof q.templates!="object")throw new Error("File missing templates object");D.value=q}catch{a.add({severity:"error",summary:i("templates.invalid_file"),detail:i("templates.invalid_file_description"),life:5e3})}},b.readAsText(n)},ce=async()=>{if(D.value){T.value=!0;try{const o=await fetch("/.netlify/functions/automation-engine",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"import_templates",payload:{templates:D.value.templates,overwrite:B.value,duplicateIfExists:!B.value}})});if(!o.ok){const b=await o.text().catch(()=>"");throw new Error(b||`HTTP ${o.status}`)}const n=await o.json();if(n.success)a.add({severity:"success",summary:i("common.success"),detail:n.message,life:5e3}),u.value=!1,await G();else throw new Error(n.error||"Failed to import templates")}catch(o){console.error("Error importing templates:",o),a.add({severity:"error",summary:i("common.error"),detail:o?.message||i("templates.failed_to_import_templates"),life:5e3})}finally{T.value=!1}}};return Oe(()=>{G()}),(o,n)=>{const b=ue,k=De,q=Fe,j=je,C=Me;return y(),x("div",Yt,[e("div",es,[e("p",ts,r(o.$t("templates.create_customize_deploy")),1),e("div",ss,[e("div",as,[v(b,{onClick:Y,severity:"secondary",text:"",class:"p-0"},{default:P(()=>[e("div",os,[e("div",ls,[n[4]||(n[4]=e("i",{class:"pi pi-upload bg-gradient-to-r from-blue-500 via-purple-500 via-pink-500 to-orange-500 bg-clip-text text-transparent"},null,-1)),e("span",rs,r(o.$t("templates.import")),1)])])]),_:1}),v(b,{onClick:U,severity:"secondary",text:"",class:"p-0"},{default:P(()=>[e("div",is,[e("div",ns,[n[5]||(n[5]=e("i",{class:"pi pi-download bg-gradient-to-r from-blue-500 via-purple-500 via-pink-500 to-orange-500 bg-clip-text text-transparent"},null,-1)),e("span",ds,r(o.$t("templates.export")),1)])])]),_:1}),v(b,{onClick:V,severity:"secondary",text:"",class:"p-0"},{default:P(()=>[e("div",cs,[n[6]||(n[6]=e("i",{class:"pi pi-plus text-white"},null,-1)),e("span",us,r(o.$t("templates.new_template")),1)])]),_:1})])])]),g.value.length===0?(y(),x("div",ms,[e("div",ps,[n[8]||(n[8]=e("div",{class:"w-20 h-20 bg-gradient-to-br from-slate-200 to-slate-300 rounded-3xl flex items-center justify-center mx-auto mb-6 text-slate-500 text-3xl"},[e("i",{class:"pi pi-inbox"})],-1)),e("h3",hs,r(o.$t("templates.no_templates_found")),1),e("p",gs,r(o.$t("templates.create_first_template_description")),1),v(b,{onClick:V,severity:"secondary",text:"",class:"p-0"},{default:P(()=>[e("div",fs,[n[7]||(n[7]=e("i",{class:"pi pi-plus text-white"},null,-1)),e("span",bs,r(o.$t("templates.create_first_template")),1)])]),_:1})])])):(y(),x("div",ys,[(y(!0),x(ie,null,ne(g.value,I=>(y(),x("div",{key:I.id,class:"bg-white rounded-2xl p-2 shadow-lg border border-slate-200/50 transition-all duration-300 hover:-translate-y-1 hover:shadow-2xl relative overflow-hidden group"},[n[13]||(n[13]=e("div",{class:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-indigo-500 to-purple-600"},null,-1)),e("div",_s,[e("div",vs,[e("h3",xs,r(I.title),1),e("p",ws,r(I.description),1),e("div",$s,[e("span",ks,r(I.propertyCount)+" "+r(o.$t("templates.properties")),1),I.custom?(y(),x("span",Ss,r(o.$t("templates.custom")),1)):(y(),x("span",Ts,r(o.$t("templates.system")),1))])]),I.custom?(y(),be(b,{key:0,onClick:le=>te(I),size:"small",severity:"danger",text:"",class:"opacity-0 group-hover:opacity-100 transition-opacity duration-200 hover:bg-red-50 rounded-full p-2"},{default:P(()=>n[9]||(n[9]=[e("i",{class:"pi pi-trash text-red-500"},null,-1)])),_:2,__:[9]},1032,["onClick"])):K("",!0)]),e("div",js,[v(b,{onClick:le=>h(I),size:"small",severity:"secondary",text:"",class:"p-0 flex-1"},{default:P(()=>[e("div",Ms,[e("div",Es,[n[10]||(n[10]=e("i",{class:"pi pi-pencil bg-gradient-to-r from-blue-500 via-purple-500 via-pink-500 to-orange-500 bg-clip-text text-transparent text-xs"},null,-1)),e("span",Cs,r(o.$t("templates.edit")),1)])])]),_:2},1032,["onClick"]),v(b,{onClick:le=>H(I),size:"small",severity:"secondary",text:"",class:"p-0 flex-1"},{default:P(()=>[e("div",Os,[e("div",Ds,[n[11]||(n[11]=e("i",{class:"pi pi-copy bg-gradient-to-r from-blue-500 via-purple-500 via-pink-500 to-orange-500 bg-clip-text text-transparent text-xs"},null,-1)),e("span",Vs,r(o.$t("templates.copy")),1)])])]),_:2},1032,["onClick"]),v(b,{onClick:le=>oe(I),size:"small",severity:"secondary",text:"",class:"p-0 flex-1"},{default:P(()=>[e("div",Is,[n[12]||(n[12]=e("i",{class:"pi pi-bolt text-white text-xs"},null,-1)),e("span",Ps,r(o.$t("templates.deploy")),1)])]),_:2},1032,["onClick"])])]))),128))])),v(k,{visible:p.value,"onUpdate:visible":n[0]||(n[0]=I=>p.value=I),schema:Q.value,onCreate:X,onCancel:F},null,8,["visible","schema"]),v(j,{visible:u.value,"onUpdate:visible":n[3]||(n[3]=I=>u.value=I),header:o.$t("templates.import_templates"),modal:"",class:"w-full max-w-2xl"},{footer:P(()=>[e("div",zs,[v(b,{onClick:n[2]||(n[2]=I=>u.value=!1),severity:"secondary",outlined:""},{default:P(()=>[Z(r(o.$t("common.cancel")),1)]),_:1}),v(b,{onClick:ce,disabled:!D.value,loading:T.value},{default:P(()=>[Z(r(o.$t("templates.import_templates_button")),1)]),_:1},8,["disabled","loading"])])]),default:P(()=>[e("div",Ns,[e("div",null,[e("label",Us,r(o.$t("templates.select_json_file")),1),e("input",{type:"file",accept:".json",onChange:A,class:"w-full p-2 border border-gray-300 rounded-lg"},null,32)]),e("div",As,[v(q,{modelValue:B.value,"onUpdate:modelValue":n[1]||(n[1]=I=>B.value=I),inputId:"overwrite"},null,8,["modelValue"]),e("label",qs,r(o.$t("templates.overwrite_existing")),1)]),D.value?(y(),x("div",Fs,[e("h4",Ls,r(o.$t("templates.preview")),1),e("div",Bs,[e("p",null,r(Object.keys(D.value.templates||{}).length)+" "+r(o.$t("templates.templates_found")),1),e("ul",Js,[(y(!0),x(ie,null,ne(Object.keys(D.value.templates||{}),I=>(y(),x("li",{key:I},r(I),1))),128))])])])):K("",!0)])]),_:1},8,["visible","header"]),v(C)])}}},Rs=me(Hs,[["__scopeId","data-v-147551ae"]]),Ks={key:0,class:"flex-shrink-0"},Gs={key:0,class:"flex items-center gap-2 text-blue-600 text-sm mb-3"},Qs={key:1,class:"mb-3"},Ws={class:"flex items-center gap-2 text-gray-500 text-sm mb-2"},Zs=["innerHTML"],Xs=["innerHTML"],Ys={key:4,class:"mt-4 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border border-blue-200"},ea={class:"flex items-center justify-between"},ta={class:"flex items-center gap-3"},sa={class:"font-semibold text-gray-900"},aa={class:"text-sm text-gray-600"},oa={class:"flex gap-2"},la={class:"text-sm text-gray-500 mt-4"},ra={key:1,class:"flex-shrink-0"},ia={key:0,class:"flex gap-4"},na={class:"bg-white border border-gray-200 rounded-2xl rounded-bl-sm px-4 py-3"},da={class:"flex items-center gap-2 text-gray-500"},ca={class:"text-sm"},ua={__name:"MessageList",props:{messages:{type:Array,required:!0},loading:{type:Boolean,required:!0}},emits:["open-schema-in-modal","copy-schema"],setup(E,{emit:s}){const{t}=pe(),a=E,m=s,i=S(null),g=()=>{se(()=>{let l=i.value;for(;l&&!l.classList.contains("overflow-y-auto");)l=l.parentElement;l||(l=i.value?.closest(".overflow-y-auto")||i.value?.closest('[class*="overflow"]')),l?l.scrollTop=l.scrollHeight:window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})})};ge(()=>a.messages,(l,f)=>{l.length>f.length&&g()},{deep:!0}),ge(()=>a.loading,(l,f)=>{f&&!l?setTimeout(()=>{g()},200):l&&g()});const p=l=>l.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,'<code class="bg-gray-100 px-1 py-0.5 rounded text-sm">$1</code>').replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" class="text-blue-600 hover:text-blue-800 underline">$1</a>').replace(/\n/g,"<br>"),u=l=>{m("open-schema-in-modal",l)},$=l=>{m("copy-schema",l)};return(l,f)=>{const T=ue;return y(),x("div",{ref_key:"messagesContainer",ref:i,class:"scrollbar-auto-hide space-y-6 py-4 px-4"},[(y(!0),x(ie,null,ne(E.messages,(w,z)=>(y(),x("div",{key:z,class:ee(["flex gap-4 animate-slide-in",w.role==="user"?"justify-end":"justify-start"])},[w.role==="assistant"?(y(),x("div",Ks,f[0]||(f[0]=[e("div",{class:"w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center"},[e("i",{class:"pi pi-sparkles text-white text-sm"})],-1)]))):K("",!0),e("div",{class:ee(["max-w-3xl",w.role==="user"?"bg-blue-500 text-white rounded-2xl rounded-br-sm px-4 py-3":"bg-white border border-gray-200 rounded-2xl rounded-bl-sm px-4 py-3"])},[w.loading?(y(),x("div",Gs,[f[1]||(f[1]=e("div",{class:"flex space-x-1"},[e("div",{class:"w-2 h-2 bg-blue-500 rounded-full animate-bounce"}),e("div",{class:"w-2 h-2 bg-purple-500 rounded-full animate-bounce",style:{"animation-delay":"0.1s"}}),e("div",{class:"w-2 h-2 bg-pink-500 rounded-full animate-bounce",style:{"animation-delay":"0.2s"}})],-1)),e("span",null,r(_(t)("chat.creating_databases")),1)])):K("",!0),w.role==="assistant"&&w.thinking?(y(),x("div",Qs,[e("div",Ws,[f[2]||(f[2]=e("div",{class:"flex space-x-1"},[e("div",{class:"w-1 h-1 bg-gray-400 rounded-full animate-pulse"}),e("div",{class:"w-1 h-1 bg-gray-400 rounded-full animate-pulse",style:{"animation-delay":"0.2s"}}),e("div",{class:"w-1 h-1 bg-gray-400 rounded-full animate-pulse",style:{"animation-delay":"0.4s"}})],-1)),e("span",null,r(_(t)("chat.thinking")),1)])])):K("",!0),w.role==="assistant"&&!w.loading&&!w.thinking?(y(),x("div",{key:2,innerHTML:p(w.content),class:"min-h-[1.2em]"},null,8,Zs)):w.role==="user"?(y(),x("div",{key:3,innerHTML:p(w.content)},null,8,Xs)):K("",!0),w.schema?(y(),x("div",Ys,[e("div",ea,[e("div",ta,[f[3]||(f[3]=e("div",{class:"w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center"},[e("i",{class:"pi pi-database text-white text-sm"})],-1)),e("div",null,[e("h4",sa,r(_(t)("chat.database_schema_ready")),1),e("p",aa,r(_(t)("chat.review_customize_schema")),1)])]),e("div",oa,[v(T,{onClick:D=>u(w),severity:"secondary",outlined:"",size:"small",class:"hover:bg-blue-50 hover:border-blue-300 hover:text-blue-700 transition-all duration-300 focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50"},{default:P(()=>[f[4]||(f[4]=e("i",{class:"pi pi-external-link mr-2"},null,-1)),Z(" "+r(_(t)("chat.open_editor")),1)]),_:2,__:[4]},1032,["onClick"]),v(T,{onClick:D=>$(w.schema),severity:"secondary",text:"",size:"small",class:"hover:bg-blue-50 hover:text-blue-700 transition-all duration-300 focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50"},{default:P(()=>f[5]||(f[5]=[e("i",{class:"pi pi-copy"},null,-1)])),_:2,__:[5]},1032,["onClick"])])]),e("p",la,"ðŸ’¡"+r(_(t)("chat.close_modal_reopen_tip")),1)])):K("",!0)],2),w.role==="user"?(y(),x("div",ra,f[6]||(f[6]=[e("div",{class:"w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center"},[e("i",{class:"pi pi-user text-gray-600 text-sm"})],-1)]))):K("",!0)],2))),128)),E.loading?(y(),x("div",ia,[f[8]||(f[8]=e("div",{class:"flex-shrink-0"},[e("div",{class:"w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center"},[e("i",{class:"pi pi-sparkles text-white text-sm"})])],-1)),e("div",na,[e("div",da,[f[7]||(f[7]=e("div",{class:"flex space-x-1"},[e("div",{class:"w-2 h-2 bg-blue-500 rounded-full animate-bounce"}),e("div",{class:"w-2 h-2 bg-purple-500 rounded-full animate-bounce",style:{"animation-delay":"0.1s"}}),e("div",{class:"w-2 h-2 bg-pink-500 rounded-full animate-bounce",style:{"animation-delay":"0.2s"}})],-1)),e("span",ca,r(_(t)("chat.ai_thinking")),1)])])])):K("",!0)],512)}}},ma={class:"mb-8"},pa={class:"text-gray-800 font-semibold text-lg group-hover:text-gray-900 transition-colors duration-300"},ha={key:0,class:"bg-white/10 backdrop-blur-sm rounded-b-xl border-l border-r border-b border-white/50 p-4 transition-all duration-300"},ga={class:"flex items-center justify-between mb-4"},fa={class:"text-lg font-semibold text-gray-900"},ba={class:"flex gap-2"},ya={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},_a=["onClick","disabled"],va={class:"flex items-center justify-between"},xa={class:"font-medium text-gray-900 group-hover:text-blue-600"},wa={class:"text-xs text-gray-500 mt-1"},$a={key:0,class:"inline-block px-2 py-1 mt-1 text-xs bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-full"},ka={__name:"TemplateSection",props:{templateMode:{type:Boolean,required:!0},templates:{type:Array,required:!0},deployingTemplate:{type:Boolean,required:!0}},emits:["update:templateMode","deploy-template-quick","show-template-editor"],setup(E,{emit:s}){const t=E,a=s,m=ae({get:()=>t.templateMode,set:u=>a("update:templateMode",u)}),i=()=>{m.value=!m.value},g=u=>{a("deploy-template-quick",u)},p=()=>{a("show-template-editor")};return(u,$)=>{const l=ue;return y(),x("div",ma,[e("div",{class:"flex items-center justify-center gap-3 mb-0 p-2 bg-white/20 backdrop-blur-sm rounded-xl border border-white/50 glass-gradient-border hover:bg-white/30 hover:shadow-lg transition-all duration-300 cursor-pointer group",onClick:i},[$[0]||($[0]=e("i",{class:"pi pi-bolt text-blue-600 text-lg group-hover:text-blue-700 transition-colors duration-300"},null,-1)),e("span",pa,r(u.$t("templates.template_mode")),1)]),m.value&&E.templates.length>0?(y(),x("div",ha,[e("div",ga,[e("h3",fa,"ðŸš€ "+r(u.$t("templates.quick_deploy_templates")),1),e("div",ba,[v(l,{onClick:p,severity:"secondary",outlined:"",size:"small",class:"hover:bg-blue-50 hover:border-blue-300 hover:text-blue-700 transition-all duration-300 focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50"},{default:P(()=>[$[1]||($[1]=e("i",{class:"pi pi-cog mr-2"},null,-1)),Z(" "+r(u.$t("templates.manage_templates")),1)]),_:1,__:[1]})])]),e("div",ya,[(y(!0),x(ie,null,ne(E.templates,f=>(y(),x("button",{key:f.id,onClick:T=>g(f),disabled:E.deployingTemplate,class:"p-3 rounded-lg transition-all duration-200 text-left group disabled:opacity-50 disabled:cursor-not-allowed relative border-2 border-transparent focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 focus:outline-none hover:origin-top-left hover:-translate-y-1 hover:rotate-0.5 hover:shadow-lg hover:border-primary-blue",style:{background:"linear-gradient(to bottom right, white, #dbeafe, #f3e8ff) padding-box, linear-gradient(135deg, #3b82f6, #8b5cf6, #ec4899) border-box"}},[e("div",va,[e("div",null,[e("p",xa,r(f.title),1),e("p",wa,r(f.propertyCount)+" "+r(u.$t("templates.properties")),1),f.custom?(y(),x("div",$a,r(u.$t("templates.custom")),1)):K("",!0)]),$[2]||($[2]=e("i",{class:"pi pi-bolt text-blue-500 opacity-0 group-hover:opacity-100 transition-opacity"},null,-1))])],8,_a))),128))])])):K("",!0)])}}},Sa=me(ka,[["__scopeId","data-v-23c58fb0"]]),Ta={class:"mb-4 md:mb-8"},ja={class:"bg-white/10 backdrop-blur-xl rounded-2xl pl-6 pt-6 pr-4 pb-4 relative flex items-center border border-white/20 shadow-2xl hover:shadow-3xl transition-all duration-500",style:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05)) padding-box, linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(139, 92, 246, 0.3), rgba(236, 72, 153, 0.3)) border-box"}},Ma=["placeholder","onKeydown"],Ea={class:"flex flex-wrap justify-center gap-3 my-8"},Ca=["onClick"],Oa={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-8"},Da=["onClick"],Va={class:"flex items-start gap-3"},Ia={class:"font-medium text-gray-900 group-hover:text-blue-600 transition-colors duration-300"},Pa={class:"text-sm text-gray-600 mt-1 group-hover:text-gray-700 transition-colors duration-300"},Na={__name:"ChatInput",props:{inputMessage:{type:String,required:!0},isListening:{type:Boolean,required:!0},quickActions:{type:Array,required:!0},suggestions:{type:Array,required:!0}},emits:["update:inputMessage","update:isListening","send-message","handle-key-down","handle-mic-or-send","handle-suggestion"],setup(E,{emit:s}){const{t}=pe(),a=E,m=s,i=ae({get:()=>a.inputMessage,set:l=>m("update:inputMessage",l)}),g=ae({get:()=>a.isListening,set:l=>m("update:isListening",l)}),p=l=>{m("handle-key-down",l)},u=()=>{m("handle-mic-or-send")},$=l=>{m("handle-suggestion",l)};return(l,f)=>(y(),x("div",Ta,[e("div",ja,[xe(e("textarea",{"onUpdate:modelValue":f[0]||(f[0]=T=>i.value=T),placeholder:l.$t("chat.placeholder"),rows:"4",type:"text",class:"flex-1 bg-transparent text-black placeholder-black placeholder:text-lg border-0 focus:ring-0 focus:border-0 focus:outline-none text-base resize-none",onKeydown:Be(Ee(p,["prevent"]),["enter"])},null,40,Ma),[[Le,i.value]]),e("button",{onClick:u,class:ee(["bg-gradient-to-br backdrop-blur-lg p-2 rounded-xl text-white hover:backdrop-blur-xl w-14 h-14 flex items-center justify-center shadow-lg hover:shadow-xl border",g.value?"from-red-500/30 to-red-400/20 border-red-400/50 hover:from-red-500/40 hover:to-red-400/30 hover:border-red-400/70":"from-white/20 to-white/10 border-white/30 hover:from-white/30 hover:to-white/20 hover:border-white/50"])},[e("i",{class:ee(["text-3xl transition-all duration-300",g.value?"pi pi-stop text-red-600 animate-pulse":i.value.trim()?"pi pi-send text-blue-600 hover:text-blue-700":"pi pi-microphone text-black hover:text-blue-600"])},null,2)],2)]),e("div",Ea,[(y(!0),x(ie,null,ne(E.quickActions,T=>(y(),x("button",{key:T.label,onClick:w=>$(T.prompt),class:"flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-blue-100 hover:text-blue-700 rounded-full text-sm text-gray-700 transition-all duration-200 focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 focus:outline-none hover:origin-top-left hover:-translate-y-0.5 hover:rotate-0.25 hover:shadow-lg hover:border-primary-blue"},[e("i",{class:ee([T.icon,"text-sm"])},null,2),Z(" "+r(T.label),1)],8,Ca))),128))]),e("div",Oa,[(y(!0),x(ie,null,ne(E.suggestions,T=>(y(),x("button",{key:T.text,onClick:w=>$(T.text),class:"p-4 bg-white/30 backdrop-blur-sm rounded-lg transition-all duration-200 text-left glass-gradient-border-light group focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 focus:outline-none hover:origin-top-left hover:-translate-y-1 hover:rotate-0.5 hover:shadow-lg hover:bg-white/40 hover:border-primary-blue"},[e("div",Va,[e("i",{class:ee([T.icon,"text-blue-500 text-lg mt-1 group-hover:text-blue-600 transition-colors duration-300"])},null,2),e("div",null,[e("p",Ia,r(T.title),1),e("p",Pa,r(T.description),1)])])],8,Da))),128))])]))}},Ua=me(Na,[["__scopeId","data-v-a7e8d84f"]]),Aa={key:0,class:"flex items-center justify-end mb-4 pb-4 border-b border-gray-200 px-4 pt-4"},qa={class:"bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 rounded-lg p-0.5 shadow-lg"},Fa={class:"bg-white rounded-md px-3 py-2 flex items-center gap-2"},La={class:"bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 bg-clip-text text-transparent font-medium"},Ba={__name:"ChatHeader",props:{messages:{type:Array,required:!0}},emits:["clear-chat"],setup(E,{emit:s}){const t=s,a=()=>{t("clear-chat")};return(m,i)=>{const g=ue;return E.messages.length>0?(y(),x("div",Aa,[v(g,{onClick:a,severity:"secondary",text:"",size:"small",class:"p-0"},{default:P(()=>[e("div",qa,[e("div",Fa,[i[0]||(i[0]=e("i",{class:"pi pi-pencil bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 bg-clip-text text-transparent"},null,-1)),e("span",La,r(m.$t("chat.new_ask")),1)])])]),_:1})])):K("",!0)}}},Ja={class:"absolute inset-0 z-0 pointer-events-none"},za={__name:"AnimatedBackground",setup(E){return(s,t)=>(y(),x("div",Ja,t[0]||(t[0]=[Je('<div class="absolute top-20 left-10 w-32 h-32 bg-gradient-to-br from-blue-400/18 to-purple-500/18 rounded-full animate-float-slow soft-background" data-v-7d3483ca></div><div class="absolute top-40 right-20 w-24 h-24 bg-gradient-to-br from-purple-400/18 to-pink-500/18 rounded-full animate-float-medium soft-background" data-v-7d3483ca></div><div class="absolute bottom-32 left-1/4 w-40 h-40 bg-gradient-to-br from-indigo-400/18 to-blue-500/18 rounded-full animate-float-slow soft-background" data-v-7d3483ca></div><div class="absolute bottom-20 right-1/3 w-28 h-28 bg-gradient-to-br from-pink-400/18 to-purple-500/18 rounded-full animate-float-medium soft-background" data-v-7d3483ca></div><div class="absolute top-1/3 left-1/2 w-20 h-20 bg-gradient-to-br from-cyan-400/14 to-blue-500/14 rotate-45 animate-spin-slow soft-background" data-v-7d3483ca></div><div class="absolute top-2/3 right-1/4 w-16 h-16 bg-gradient-to-br from-emerald-400/14 to-teal-500/14 rounded-lg animate-bounce-gentle soft-background" data-v-7d3483ca></div><div class="absolute top-1/4 right-1/2 w-12 h-12 bg-gradient-to-br from-violet-400/14 to-purple-500/14 rounded-full animate-pulse-slow soft-background" data-v-7d3483ca></div><div class="absolute top-30 right-1/3 w-8 h-8 bg-gradient-to-br from-yellow-400/21 to-orange-500/21 rounded-full animate-bounce-slow soft-background" data-v-7d3483ca></div><div class="absolute bottom-1/3 left-16 w-6 h-6 bg-gradient-to-br from-rose-400/21 to-pink-500/21 rounded-full animate-ping-slow soft-background" data-v-7d3483ca></div><div class="absolute top-1/2 left-8 w-10 h-10 bg-gradient-to-br from-sky-400/21 to-cyan-500/21 rounded-full animate-pulse-medium soft-background" data-v-7d3483ca></div>',10)])))}},Ha=me(za,[["__scopeId","data-v-7d3483ca"]]),Ra="/assets/Google_Gemini_logo-7q50a1rP.png",Se="/assets/Notion-logo-OVZkis7M.png";function Ka(){const E=we(),{t:s}=pe(),t=S(!1),a=S(null),m=S(!1),i=()=>(m.value=!!(window.SpeechRecognition||window.webkitSpeechRecognition),m.value),g=($,l)=>{if(!i())return E.add({severity:"warn",summary:s("chat.voice_not_supported"),detail:s("chat.browser_not_supported"),life:5e3}),!1;try{const f=window.SpeechRecognition||window.webkitSpeechRecognition;return a.value=new f,a.value.continuous=!0,a.value.interimResults=!0,a.value.lang="en-US",a.value.maxAlternatives=1,a.value.onstart=()=>{t.value=!0,E.add({severity:"info",summary:s("chat.listening"),detail:s("chat.speak_now"),life:3e3})},a.value.onresult=T=>{let w="",z="";for(let D=T.resultIndex;D<T.results.length;D++){const B=T.results[D][0].transcript;T.results[D].isFinal?w+=B:z+=B}$&&$({finalTranscript:w,interimTranscript:z})},a.value.onerror=T=>{t.value=!1;let w="Voice recognition error occurred.";switch(T.error){case"no-speech":w="No speech detected. Please speak louder or check your microphone.";break;case"audio-capture":w="No microphone found. Please check your microphone connection.";break;case"not-allowed":w="Microphone permission denied. Please allow microphone access.";break;case"network":w="Network error. Please check your internet connection.";break;case"aborted":w="Voice recognition was aborted. Please try again.";break;case"language-not-supported":w="Language not supported. Please try again.";break;default:w=`Voice recognition error: ${T.error}`}E.add({severity:"error",summary:"Voice Error",detail:w,life:5e3}),l&&l(T.error,w)},a.value.onend=()=>{t.value=!1},a.value.onspeechstart=()=>{E.add({severity:"info",summary:"Speech Detected",detail:"I can hear you speaking!",life:2e3})},a.value.start(),!0}catch(f){return t.value=!1,console.error("Voice recognition error:",f),E.add({severity:"error",summary:"Voice Error",detail:"Failed to start voice recognition. Please try again.",life:3e3}),!1}},p=()=>{a.value&&a.value.stop(),t.value=!1};return{isListening:t,browserSupported:m,checkBrowserSupport:i,startRecognition:g,stopRecognition:p,toggleRecognition:($,l)=>t.value?(p(),E.add({severity:"info",summary:"Voice Stopped",detail:"Voice recognition stopped.",life:2e3}),!1):g($,l)}}class Ga{async getTemplateSchema(s){const t=await fetch("/.netlify/functions/automation-engine",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"get_template_schema",payload:{templateId:s}})});if(!t.ok){const m=await t.text().catch(()=>"");throw new Error(m||"Failed to fetch template schema")}const a=await t.json();return{title:a?.schema?.title||a?.template?.title||"",description:a?.schema?.description||a?.template?.description||"",dataSources:a?.schema?.dataSources||[]}}}const Qa=new Ga,Wa=ze("template",()=>{const E=S(!1),s=S({title:"",description:"",dataSources:[]}),t=S(!1),a=S(""),m=g=>Array.isArray(g)?g.map(p=>({name:p.name||p.title||"Property",type:p.type||"rich_text",options:Array.isArray(p.options)?p.options.map(u=>typeof u=="string"?u:u?.name).filter(Boolean).join(`
`):p.options||"",format:p.format||p.number?.format||"number"})):g&&typeof g=="object"?Object.entries(g).map(([p,u])=>({name:p,type:u?.type||(u?Object.keys(u)[0]:"rich_text")||"rich_text",options:(u?.select?.options||u?.multi_select?.options||[]).map($=>$?.name).filter(Boolean).join(`
`),format:u?.number?.format||"number"})):[];return{showMultiSourceEditModal:E,multiSourceSchema:s,loading:t,error:a,fetchTemplateSchema:async(g,p="")=>{t.value=!0,a.value="",E.value=!0,s.value={title:p||"Loading schema...",description:"",dataSources:[]};try{const u=await Qa.getTemplateSchema(g),$=Array.isArray(u.dataSources)?u.dataSources:Array.isArray(u.databases)?u.databases:[];s.value={title:u.title||p||"System",description:u.description||"",dataSources:$.map(l=>({name:l.name||l.title||"Data Source",description:l.description||"",properties:m(l.properties)}))}}catch(u){a.value=u?.message||"Failed to fetch template schema",s.value={title:p||"Template",description:"Unable to load schema. Please try again.",dataSources:[]}}finally{t.value=!1}}}}),Za={class:"relative overflow-hidden bg-gradient-to-br from-gray-100 to-blue-100 min-h-screen"},Xa={class:"relative z-10 bg-transparent"},Ya={key:0,class:"flex items-center justify-center bg-transparent px-4 py-8"},eo={class:"text-center bg-transparent"},to={class:"flex flex-col justify-center mb-6 max-w-2xl mx-auto px-4"},so={class:"text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 bg-clip-text text-transparent text-center sm:text-left"},ao=["alt"],oo={class:"flex justify-center"},lo={class:"text-xs sm:text-sm text-gray-500"},ro=["alt"],io={class:"w-full"},no={class:"flex items-center gap-4"},co={class:"text-center md:text-left"},uo={class:"text-2xl md:text-3xl font-bold text-white drop-shadow-sm"},mo={class:"box-border bg-gradient-to-br from-slate-50 to-slate-100"},po={class:"flex items-center gap-3 mb-4"},ho={class:"text-gray-600 text-sm"},go={class:"flex justify-end gap-2"},fo={__name:"ChatView",setup(E){const{t:s,locale:t}=pe(),a=we(),{isListening:m,toggleRecognition:i}=Ka(),g=S([]),p=S(""),u=S(""),$=S(!1),l=S(!1),f=S(!1),T=S([]),w=S(!1),z=S(!1),D=Wa(),B=ae({get:()=>D.showMultiSourceEditModal,set:d=>D.showMultiSourceEditModal=d}),Q=ae(()=>D.multiSourceSchema),G=S(!1),V=S(!1),h=ae(()=>typeof window>"u"?!1:window.innerWidth<=768),X={root:{class:"rounded-l-2xl shadow-2xl border border-white/10 backdrop-blur-sm bg-transparent"},header:{class:"bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 text-white rounded-l-2xl !p-2"},content:{class:"bg-gradient-to-br from-slate-50 to-slate-100 rounded-b-2xl"}};ge(f,async d=>{d&&T.value.length===0&&await q()});const F=ae(()=>[{icon:"pi pi-database",title:s("chat.suggestions.project_management.title"),description:s("chat.suggestions.project_management.description"),text:s("chat.suggestions.project_management.text")},{icon:"pi pi-users",title:s("chat.suggestions.customer_management.title"),description:s("chat.suggestions.customer_management.description"),text:s("chat.suggestions.customer_management.text")},{icon:"pi pi-book",title:s("chat.suggestions.content_management.title"),description:s("chat.suggestions.content_management.description"),text:s("chat.suggestions.content_management.text")},{icon:"pi pi-chart-line",title:s("chat.suggestions.analytics_dashboard.title"),description:s("chat.suggestions.analytics_dashboard.description"),text:s("chat.suggestions.analytics_dashboard.text")}]),H=ae(()=>[{icon:"pi pi-calendar",label:s("chat.quick_actions.event_system"),prompt:s("chat.quick_actions.event_system_prompt")},{icon:"pi pi-shopping-cart",label:s("chat.quick_actions.inventory_system"),prompt:s("chat.quick_actions.inventory_system_prompt")},{icon:"pi pi-graduation-cap",label:s("chat.quick_actions.learning_system"),prompt:s("chat.quick_actions.learning_system_prompt")},{icon:"pi pi-heart",label:s("chat.quick_actions.wellness_system"),prompt:s("chat.quick_actions.wellness_system_prompt")},{icon:"pi pi-th-large",label:s("chat.quick_actions.ecommerce_system"),prompt:s("chat.quick_actions.ecommerce_system_prompt")}]),oe=d=>{p.value=d,U()},te=d=>{d.key==="Enter"&&!d.shiftKey&&U()},U=async()=>{if(!p.value.trim()||$.value)return;const d={id:Date.now()+Math.random(),role:"user",content:p.value.trim(),timestamp:new Date};g.value.push(d);const c=p.value.trim();p.value="",$.value=!0;try{const L=c.toLowerCase();if(f.value){const M=await j(c);if(M&&M.confidence>.8){await C(M.suggestedTemplate,{title:M.customizations?.title||c,...M.customizations});return}}const N=await fe.geminiChat(c,t.value);if(N.schema){const M=Y(N.schema);D.multiSourceSchema=M,D.showMultiSourceEditModal=!0,G.value=!1;const W={id:Date.now()+Math.random(),role:"assistant",content:`ðŸŽ¯ **${s("chat.database_schema_generated")}**

${s("chat.schema_created_message")}

**${s("chat.generated_system")}:** ${N.schema.title||s("chat.custom_database_system")}
**${s("common.description")}:** ${N.schema.description||s("chat.comprehensive_database_system")}

${s("chat.modal_allows_you_to")}:
- ${s("chat.edit_system_title_description")}
- ${s("chat.modify_data_sources_properties")}
- ${s("chat.add_remove_properties")}
- ${s("chat.customize_property_types_options")}

${s("chat.once_satisfied_configuration")}

`,timestamp:new Date,schema:N.schema};g.value.push(W);return}const O={id:Date.now()+Math.random(),role:"assistant",content:N.content,schema:N.schema||null,type:N.type||"single",timestamp:new Date};g.value.push(O)}catch(L){console.error("Error sending message:",L),a.add({severity:"error",summary:s("common.error"),detail:s("forms.failed_to_send_message",{error:L.message}),life:5e3}),g.value.push({id:Date.now()+Math.random(),role:"assistant",content:s("chat.error_processing_request"),timestamp:new Date})}finally{$.value=!1,await se(),k()}},Y=d=>({title:d.title||"",description:d.description||"",dataSources:d.dataSources?d.dataSources.map(c=>{const L={name:c.name||"",description:c.description||"",properties:[]};return c.properties&&typeof c.properties=="object"&&(L.properties=Object.entries(c.properties).map(([N,O])=>{let M="rich_text",W="",re="number";return O.title?M="title":O.rich_text?M="rich_text":O.number?(M="number",re=O.number.format||"number"):O.select?(M="select",W=O.select.options?O.select.options.map(de=>de.name).join(`
`):""):O.multi_select?(M="multi_select",W=O.multi_select.options?O.multi_select.options.map(de=>de.name).join(`
`):""):O.date?M="date":O.people?M="people":O.files?M="files":O.checkbox?M="checkbox":O.url?M="url":O.email?M="email":O.phone_number?M="phone_number":O.created_time?M="created_time":O.created_by?M="created_by":O.last_edited_time?M="last_edited_time":O.last_edited_by&&(M="last_edited_by"),{name:N,type:M,options:W,format:re}})),L}):[]}),A=async d=>{try{await navigator.clipboard.writeText(JSON.stringify(d,null,2)),a.add({severity:"success",summary:s("common.success"),detail:s("chat.schema_copied"),life:3e3})}catch(c){console.error("Error copying schema:",c),a.add({severity:"error",summary:s("common.error"),detail:s("chat.failed_to_copy_schema"),life:3e3})}},ce=d=>{const c=Y(d.schema);D.multiSourceSchema=c,D.showMultiSourceEditModal=!0,G.value=!1},o=()=>{if(m.value){n();return}p.value.trim()?U():n()},n=()=>{m.value||(u.value=p.value),i(({finalTranscript:d,interimTranscript:c})=>{d?(u.value+=d+" ",p.value=u.value):c&&(p.value=u.value+c+" [listening...]")},()=>{p.value=u.value}),m.value||(p.value=u.value)};let b=!1;const k=()=>{b||(b=!0,requestAnimationFrame(()=>{const d=document.querySelector(".overflow-y-auto");d&&(d.scrollTop=d.scrollHeight),b=!1}))},q=async()=>{try{const d=await fe.listTemplates();T.value=d.templates||[]}catch(d){console.error("Error loading templates:",d)}},j=async d=>{try{return await fe.smartSuggest(d)}catch(c){return console.error("Error getting smart suggestion:",c),null}},C=async(d,c={})=>{w.value=!0;try{await D.fetchTemplateSchema(d,c.title);const L=Q.value;c.title&&(L.title=c.title),c.description&&(L.description=c.description),await se(),D.multiSourceSchema=L,D.showMultiSourceEditModal=!0,G.value=!0;return}catch(L){console.error("Error deploying template:",L),a.add({severity:"error",summary:s("chat.automation_error"),detail:s("chat.failed_to_auto_deploy_template"),life:5e3})}finally{w.value=!1,$.value=!1,await se(),k()}},I=async d=>{B.value=!0,Q.value={title:d?.name||s("chat.loading_schema"),description:"",dataSources:[]};try{await D.fetchTemplateSchema(d.id,d.title||d.name);return}catch(c){console.error("deployTemplateQuick failed:",c),Q.value={title:d?.name||s("chat.template"),description:s("chat.unable_to_load_schema"),dataSources:[]},a.add({severity:"error",summary:s("chat.template_schema_error"),detail:c?.message||s("chat.failed_to_fetch_template_schema"),life:5e3})}},le=d=>{a.add({severity:"success",summary:s("chat.template_deployed"),detail:s("chat.database_available",{title:d.title}),life:5e3}),z.value=!1},he=async({schema:d,fromTemplate:c}={})=>{B.value=!1,l.value=!0;let L={id:Date.now()+Math.random(),role:"assistant",content:`ðŸ”„ **${s("chat.creating_system",{title:d.title||s("chat.your_system")})}**

${s("chat.please_wait_setup")}`,timestamp:new Date,loading:!0};g.value.push(L),await se(),k();try{const N=await fe.createMultiSourceDatabase(d,"separate"),O=g.value.findIndex(R=>R.id===L.id);O!==-1&&g.value.splice(O,1);const M=[];for(const R of N.databases){const _e=R.title||R.name||"Untitled Database",ve=R.url||"#",J=R.id||"";let $e=s("database.no_properties");Array.isArray(R.properties)&&R.properties.length>0&&($e=R.properties.join(", "));const Pe=`**<img src="${Se}" alt="Notion" style="width: 16px; height: 16px; display: inline-block; vertical-align: middle; margin-right: 4px;" /> [${_e}](${ve})**
   - ${s("database.columns")}: ${$e}
   - [ðŸ”— ${s("database.open_in_app")}](/db/${J})`;M.push(Pe)}const W=M.join(`

`),re=d.title||s("templates.system"),de=N.databases.length,ye={id:Date.now()+Math.random(),role:"assistant",content:`âœ… **${re} ${s("database.created_successfully")}**

${s("database.created")} ${de} ${s("database.databases")}:

${W}

${s("database.start_adding_data")}`,timestamp:new Date};g.value.push(ye),await se(),k(),N.hasErrors?a.add({severity:"warn",summary:s("chat.system_created_with_issues"),detail:s("chat.databases_created_failed",{created:N.databases.filter(R=>!R.status||R.status!=="error").length,failed:N.errors.length}),life:1e4}):a.add({severity:"success",summary:s("chat.system_created",{title:d.title||"System"}),detail:s("chat.databases_created_successfully",{count:N.databases.length,title:d.title?d.title.toLowerCase():"system"}),life:8e3})}catch(N){console.error("Error creating system:",N);const O=g.value.findIndex(re=>re.id===L.id);O!==-1&&g.value.splice(O,1);const M=N.message||N.toString(),W={id:Date.now()+Math.random(),role:"assistant",content:"âŒ Failed to create system. Error: "+M,timestamp:new Date};g.value.push(W),await se(),k(),a.add({severity:"error",summary:s("chat.creation_failed"),detail:M,life:1e4})}finally{l.value=!1,await se(),k()}},Ve=()=>{B.value=!1,a.add({severity:"info",summary:s("chat.operation_cancelled"),detail:s("chat.schema_editing_cancelled"),life:3e3}),k()},Ie=()=>{g.value=[],B.value=!1,Q.value={},V.value=!1,a.add({severity:"success",summary:s("chat.chat_cleared"),detail:s("chat.chat_cleared_successfully"),life:3e3}),se(()=>{const d=document.querySelector("textarea");d&&d.focus()})};return Oe(async()=>{const d=document.querySelector("textarea");d&&d.focus(),await q()}),(d,c)=>{const L=Ha,N=Ba,O=Ua,M=Sa,W=ua,re=Rs,de=Te,ye=De,R=ue,_e=je,ve=Me;return y(),x("div",Za,[v(L),e("div",Xa,[v(N,{messages:g.value,onClearChat:c[0]||(c[0]=J=>V.value=!0)},null,8,["messages"]),g.value.length===0?(y(),x("div",Ya,[e("div",eo,[e("div",to,[e("div",{class:ee(["flex flex-row items-end justify-center gap-2 sm:gap-4 mb-4",{"flex-row-reverse":_(t)==="hi"}])},[e("p",so,r(d.$t("chat.create_with")),1),e("img",{src:Ra,alt:d.$t("chat.gemini_ai"),class:"w-32 sm:w-20 md:w-32 lg:w-50 object-contain"},null,8,ao)],2),e("div",oo,[e("div",{class:ee(["flex flex-row items-center gap-2",{"flex-row-reverse":_(t)==="hi"}])},[e("span",lo,r(d.$t("chat.powered_by")),1),c[9]||(c[9]=e("span",{class:"text-xs sm:text-sm font-semibold text-gray-700"},"Notion",-1)),e("img",{src:Se,alt:d.$t("chat.notion_db"),class:"w-4 sm:w-5 object-contain"},null,8,ro)],2)])]),v(O,{inputMessage:p.value,"onUpdate:inputMessage":c[1]||(c[1]=J=>p.value=J),isListening:_(m),"onUpdate:isListening":c[2]||(c[2]=J=>He(m)?m.value=J:null),onSendMessage:U,onHandleKeyDown:te,onHandleMicOrSend:o,onHandleSuggestion:oe,quickActions:H.value,suggestions:F.value},null,8,["inputMessage","isListening","quickActions","suggestions"]),v(M,{templateMode:f.value,"onUpdate:templateMode":c[3]||(c[3]=J=>f.value=J),templates:T.value,deployingTemplate:w.value,onDeployTemplateQuick:I,onShowTemplateEditor:c[4]||(c[4]=J=>z.value=!0)},null,8,["templateMode","templates","deployingTemplate"])])])):(y(),be(W,{key:1,messages:g.value,loading:$.value,onOpenSchemaInModal:ce,onCopySchema:A},null,8,["messages","loading"]))]),v(de,{visible:z.value,"onUpdate:visible":c[5]||(c[5]=J=>z.value=J),position:h.value?"bottom":"right",class:"modern-template-drawer",style:Ce(h.value?{height:"90vh"}:{width:"95vw",maxWidth:"1400px"}),pt:X},{header:P(()=>[e("div",io,[e("div",no,[c[10]||(c[10]=e("div",{class:"w-12 h-12 md:w-14 md:h-14 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center border border-white/10"},[e("i",{class:"pi pi-objects-column text-white text-lg md:text-xl"})],-1)),e("div",co,[e("h2",uo,r(d.$t("templates.template_manager")),1)])])])]),default:P(()=>[e("div",mo,[v(re,{onTemplateDeployed:le})])]),_:1},8,["visible","position","style"]),v(ye,{visible:B.value,"onUpdate:visible":c[6]||(c[6]=J=>B.value=J),schema:Q.value,fromTemplate:G.value,onCreate:he,onCancel:Ve},null,8,["visible","schema","fromTemplate"]),v(_e,{visible:V.value,"onUpdate:visible":c[8]||(c[8]=J=>V.value=J),modal:"",header:d.$t("chat.clear_chat"),style:{width:"400px"}},{footer:P(()=>[e("div",go,[v(R,{label:d.$t("common.cancel"),severity:"secondary",outlined:"",onClick:c[7]||(c[7]=J=>V.value=!1),class:"hover:bg-gray-50 hover:border-gray-300 hover:text-gray-700 transition-all duration-300 focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50"},null,8,["label"]),v(R,{label:d.$t("chat.start_fresh_chat"),severity:"danger",onClick:Ie,class:"hover:bg-red-600 hover:border-red-600 transition-all duration-300 focus:ring-2 focus:ring-red-500 focus:ring-opacity-50"},null,8,["label"])])]),default:P(()=>[e("div",po,[c[11]||(c[11]=e("div",{class:"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center"},[e("i",{class:"pi pi-exclamation-triangle text-orange-500 text-xl"})],-1)),e("div",null,[e("p",ho,r(d.$t("chat.clear_chat_confirmation")),1)])])]),_:1},8,["visible","header"]),v(ve)])}}},vo=me(fo,[["__scopeId","data-v-bcee88f2"]]);export{vo as default};
